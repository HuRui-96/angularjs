function changebuycar(opt){if(0==$(opt.dom).length)return!1;var amount=$(opt.dom).find("div[dk-bind='amount']").text(),productid=JSON.parse($(opt.dom).attr("data")).productid;$.get("http://10.3.134.63/show/oyav2/php/changebuycar.php?amount="+amount+"&productid="+productid+"&del="+opt.del,function(rep){var change=eval("("+rep+")");change.state?opt.del&&$(opt.dom).remove():alert(change.message)})}function allmoney(){var e=$("#scroller i.icon-ok-circle").closest("ul"),t=0;$.each(e,function(e,a){t+=parseInt($(a).find("span[dk-bind='money']").text())*parseInt($(a).find("div[dk-bind='amount']").text())}),$(".footer>div:last-child>a>span").text(t)}$(function(){$("header").load("header1.html",function(e,t,a){"success"==t&&($(".header1").find("div").text("购物车"),setTimeout(function(){$("header").show()},50))}),$("footer").load("footer1.html",function(responseTxt,statusTxt,xhr){"success"==statusTxt&&($(".footer>div").eq(0).find("i").removeClass("icon-shopping-cart").addClass("icon-circle-blank").next("span").text("全选"),$(".footer>div").eq(1).find("a").html("<span>支付方式</span><i class='icon-chevron-up'></i>"),$(".footer>div").eq(2).html("<a>确认下单(<span>0</span>)</a>"),$.get(baseurl+"php/buycar.php",function(rep){var result=eval("("+rep+")");if(console.log(result),result.state||($("#scroller>ul").remove(),location.assign("login.html")),0==result.message.length)$("#scroller>ul").remove();else{var _obj={baseDom:"#scroller>ul",cloneSize:6,data:{data:result.message},toscroll:!0,scrolldom:".buycar",appenfcount:6,readydom:".ready"},products1=new clonedom(_obj);$("div.buycar").show()}}),$("footer").show())});var it=!0;$(document).on("touchstart",function(e){it=!0}),$(document).on("touchmove",function(e){it=!1}),$(document).on("touchend",function(evt){if(0==it)return!1;if($(evt.target).is(".footer>div:nth-child(2)>a>*")||$(evt.target).is(".footer>div:nth-child(2)>a"))$(".selectpay").toggle();else if($(evt.target).is(".selectpay>div>p"))$(".selectpay").toggle(),$(".footer>div").eq(1).find("span").text($(evt.target).text());else if($(evt.target).is(".option>div>div>i"))$(evt.target).hasClass("icon-minus")?$(evt.target).closest("div").next().text()>1&&($(evt.target).closest("div").next().text($(evt.target).closest("div").next().text()-1),changebuycar({dom:$(evt.target).closest("ul"),del:!1}),allmoney()):$(evt.target).hasClass("icon-plus")?($(evt.target).closest("div").prev().text(parseInt($(evt.target).closest("div").prev().text())+1),changebuycar({dom:$(evt.target).closest("ul"),del:!1}),allmoney()):$(evt.target).hasClass("icon-trash")&&(changebuycar({dom:$(evt.target).closest("ul"),del:!0}),allmoney());else if($(evt.target).is("ul>li:first-child>i"))$(evt.target).toggleClass("icon-circle-blank").toggleClass("icon-ok-circle"),allmoney();else if($(evt.target).is(".footer>div:first-child>a>i"))$(evt.target).toggleClass("icon-circle-blank").toggleClass("icon-ok-circle"),$(evt.target).hasClass("icon-ok-circle")?($("ul>li:first-child>i").removeClass("icon-circle-blank").addClass("icon-ok-circle"),allmoney()):($("ul>li:first-child>i").addClass("icon-circle-blank").removeClass("icon-ok-circle"),allmoney());else if($(evt.target).is(".footer>div:first-child>a"))$(evt.target).find("i").toggleClass("icon-circle-blank").toggleClass("icon-ok-circle"),$(evt.target).find("i").hasClass("icon-ok-circle")?($("ul>li:first-child>i").removeClass("icon-circle-blank").addClass("icon-ok-circle"),allmoney()):($("ul>li:first-child>i").addClass("icon-circle-blank").removeClass("icon-ok-circle"),allmoney());else if($(evt.target).is(".footer>div:last-child>a")||$(evt.target).is(".footer>div:last-child>a>span")){if($(evt.target).is("span")){if(0==$(evt.target).text())return void alert("请选择商品");if("支付方式"==$(".footer>div:nth-child(2)>a>span").text())return void alert("请选择支付方式")}else{if(0==$(evt.target).children("span").text())return void alert("请选择商品");if("支付方式"==$(".footer>div:nth-child(2)>a>span").text())return void alert("请选择支付方式")}var array1=$("#scroller i.icon-ok-circle").closest("ul"),d=new Date,array2=[];$.each(array1,function(e,t){array2.push(JSON.parse($(t).attr("data")).productid)}),$.get("http://10.3.134.63/show/oyav2/php/tobuylist.php?product="+JSON.stringify(array2)+"&listnum="+d.getTime()+"&payway="+$(".footer>div:nth-child(2)>a>span").text(),function(rep){var repp=eval("("+rep+")");alert(repp.message),repp.state&&($("#scroller i.icon-ok-circle").closest("ul").remove(),location.assign("tobuy.html"))})}})});