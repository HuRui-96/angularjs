var baseurl="http://10.3.134.63/show/oyav2/",myapp=angular.module("myapp",["ui.router","oc.lazyLoad","commonApp"]);myapp.factory("checknow",["$http",function(e){var o={};return o.check=function(o){e.get(baseurl+"php/checknowuser.php").success(function(e){"false"==e.state?location.assign("viploginin.html"):o()})},o}]),myapp.config(function(e,o,t){e.state("user",{url:"/user",templateUrl:"datagird.html?_"+Math.random(),controller:"user",resolve:{des:function(e){e.load([{files:["max/vip-user.css"],cache:!0}])}}}).state("product",{url:"/product",templateUrl:"datagird2.html?_"+Math.random(),controller:"product",resolve:{des:function(e){e.load([{files:["max/vip-product.css"],cache:!0}])}}}).state("changepass",{url:"/changepass",templateUrl:"changepass.html?_"+Math.random(),controller:"changepass",resolve:{des:function(e){e.load([{files:["max/vip-changepass.css"],cache:!0}])}}}),t.config({debug:!0,events:!0})}),myapp.controller("changepass",["$scope","$http","checknow",function(e,o,t){e.newpass="",e.repass="",e.oldpass="",e.show=!0,e.newpassword=function(){e.newpass.length<8||e.repass.length<8||e.oldpass.length<8?(e.passtitle="密码长度不小于8位",e.show=!1):e.repass!=e.newpass?(e.passtitle="两次新密码不一致",e.show=!1):(e.show=!0,t.check(function(){o.post(baseurl+"php/changeyippass.php",{oldpwd:e.oldpass,newpwd:e.newpass}).success(function(o){alert(o.message),o.state&&(e.newpass="",e.repass="",e.oldpass="")})}))}}]),myapp.controller("headcon",["$scope","$http",function(e,o){o.get(baseurl+"php/checknowuser.php").success(function(o){"false"==o.state?location.assign("viploginin.html"):(console.log(o),e.user=o.data[0].account)})}]);var mycon=myapp.controller("mycon",["$scope","$http","$compile","checknow",function(e,o,t,s){"#/user"==location.hash?$("div.where span").eq(1).text("用户信息"):"#/product"==location.hash?$("div.where span").eq(1).text("商品信息"):""==location.hash?$("div.where span").eq(1).text("首页"):"#/changepass"==location.hash&&$("div.where span").eq(1).text("修改密码"),s.check(function(){o.post(baseurl+"php/vipuserlist.php").success(function(t){e.result=t.data[0],e.nowli="",e.towhere=function(e,t){$(t.target).closest("li").addClass("li-selected").siblings("li").removeClass("li-selected"),"用户信息"==e?(location.hash="#/user",$("div.where span").eq(1).text("用户信息")):"商品信息"==e?(location.hash="#/product",$("div.where span").eq(1).text("商品信息")):"退出登录"==e?o.get("php/viplogout.php").success(function(e){location.assign("viploginin.html")}):"修改密码"==e&&(location.hash="#/changepass",$("div.where span").eq(1).text("修改密码"))}})}),e.nowlist=function(e){return"用户信息"==e&&"#/user"==location.hash?"li-selected":"商品信息"==e&&"#/product"==location.hash?"li-selected":"修改密码"==e&&"#/changepass"==location.hash?"li-selected":void 0}}]);myapp.controller("user",["$scope","$http","$sce","checknow",function(e,o,t,s){e.search="",e.language="cn",e.optionshow=!1,e.editshow=!0,e.returnli=function(){e.optionshow=!1},s.check(function(){o.get(baseurl+"libs/data/dictionary.txt").success(function(t){e.dictionary=t,e.searchrange=e.dictionary.indexid[e.language],o.get("php/user.php").success(function(o){e.data=o.data,e.colspan=0,e.pagerows=8;for(var t in e.data[0])e.colspan+=1;e.pagecount=Math.ceil(e.data.length/8);for(var s=[],t=1;t<=e.pagecount;t++)s.push(t);e.arr=s,e.pageindex=1})})}),e.interpret=function(o){return e.dictionary[o][e.language]},e.clonn=function(o,t){$(t.target).closest("tr").addClass("tr-selected").siblings("tr").removeClass("tr-selected"),delete o.$$hashKey,e.cloned=o,e.optionshow=!0,e.editshow=!0},e.dischange=function(e,o){return"indexid"==e||"phone"==e?t.trustAsHtml("<div class='"+e+"'>"+o+"</div>"):t.trustAsHtml('<input type="text" value="'+o+'" name="'+e+'" />')},e.upuser=function(){if(0==$("[name=account]").val())return alert("用户昵称不能为空"),!1;if($("[name=password]").val().length<8)return alert("密码不能小于8位"),!1;var t={indexid:$(".indexid").text(),phone:$(".phone").text(),account:$("[name=account]").val(),password:$("[name=password]").val()};s.check(function(){$.post(baseurl+"php/cahngeuser.php",t,function(t){alert(JSON.parse(t).message),o.get("php/user.php").success(function(o){e.data=o.data})})})},e.page=function(o){e.pageindex=o},e.mysearch=function(o){for(var t in e.dictionary)if(e.dictionary[t][e.language]==e.searchrange&&o[t].toString().indexOf(e.search)>-1)return o},e.changepage=function(){for(var o=0,t=0;t<e.data.length;t++)for(var s in e.dictionary)e.dictionary[s][e.language]==e.searchrange&&e.data[t][s].toString().indexOf(e.search)>-1&&o++;e.pagecount=Math.ceil(o/e.pagerows);for(var a=[],c=1;c<=e.pagecount;c++)a.push(c);e.arr=a,e.pageindex=1,console.log(o)}}]),myapp.controller("product",["$scope","$http","$sce","checknow",function($scope,$http,$sce,checknow){$scope.search="",$scope.language="cn",$scope.optionshow=!1,$scope.editshow=!0,$scope.addshow=!0,$scope.returnli=function(){$scope.optionshow=!1,$scope.editshow=!1,$scope.addshow=!1},checknow.check(function(){$http.get(baseurl+"libs/data/dictionary.txt").success(function(e){$scope.dictionary=e,$scope.searchrange=$scope.dictionary.productid[$scope.language],$http.get("php/prod.php").success(function(e){$scope.data=e.data,$scope.colspan=0,$scope.pagerows=8;for(var o in $scope.data[0])$scope.colspan+=1;$scope.pagecount=Math.ceil($scope.data.length/$scope.pagerows);for(var t=[],o=1;o<=$scope.pagecount;o++)t.push(o);$scope.arr=t,$scope.pageindex=1})})}),$scope.interpret=function(e){return $scope.dictionary[e][$scope.language]},$scope.delete=function(e){checknow.check(function(){confirm("确定删除该商品，商品号："+e.productid+"  商品名："+e.title)&&$.post(baseurl+"php/delpro.php",e,function(e){alert(JSON.parse(e).message),$http.get(baseurl+"php/prod.php").success(function(e){$scope.data=e.data,$scope.changepage()})})})},$scope.selctimg=function(e,o){return"src"==e?$sce.trustAsHtml('<img src="'+o+'"/>'):$sce.trustAsHtml("<p>"+o+"</p>")},$scope.upproduct=function(){return 0==$("[name=money]").eq(1).val().length?(alert("价格不能为空"),!1):0==$("[name=title]").eq(1).val().length?(alert("商品名不能为空"),!1):void(0==$("form.upproduct input").val().length?checknow.check(function(){$.post(baseurl+"php/changeproduct.php",{productid:$scope.cloned.productid,money:$("[name=money]").eq(1).val(),title:$("[name=title]").eq(1).val(),src:$scope.cloned.src},function(repson){var repp=eval("("+repson+")");alert(repp.message),$http.get(baseurl+"php/prod.php").success(function(e){$scope.data=e.data})})}):checknow.check(function(){$("form.upproduct").ajaxSubmit({type:"post",url:baseurl+"php/form.php",success:function(data){var dd=JSON.parse(data);dd.status&&(console.log(dd),$.post(baseurl+"php/changeproduct.php",{productid:$scope.cloned.productid,money:$("[name=money]").eq(1).val(),title:$("[name=title]").eq(1).val(),src:"img/"+dd.fileName},function(repson){var repp=eval("("+repson+")");alert(repp.message),$http.get(baseurl+"php/prod.php").success(function(e){$scope.data=e.data})}))},error:function(e,o,t){console.log(e),console.log(o),console.log(t)}})}))},$scope.showadd=function(){$("[name=money]").eq(0).val(""),$("[name=title]").eq(0).val(""),$("form.upprod input").val(""),$(".tr-selected").removeClass("tr-selected"),$scope.optionshow=!0,$scope.editshow=!1,$scope.addshow=!0},$scope.clonn=function(e,o){$(o.target).closest("tr").addClass("tr-selected").siblings("tr").removeClass("tr-selected"),delete e.$$hashKey,$scope.cloned=e,$scope.optionshow=!0,$scope.editshow=!0,$scope.addshow=!1},$scope.dischange=function(e,o){return"productid"==e?$sce.trustAsHtml("<div>"+o+"</div>"):"src"==e?$sce.trustAsHtml('<form class="upproduct"><input type="file" name="file" /></form>'):$sce.trustAsHtml('<input type="text" value="'+o+'" name="'+e+'" />')},$scope.page=function(e){$scope.pageindex=e},$scope.mysearch=function(e){for(var o in $scope.dictionary)if($scope.dictionary[o][$scope.language]==$scope.searchrange&&e[o].toString().indexOf($scope.search)>-1)return e},$scope.upprod=function(){return 0==$("[name=money]").eq(0).val().length?(alert("价格不能为空"),!1):0==$("[name=title]").eq(0).val().length?(alert("商品名不能为空"),!1):0==$("form.upprod input").val().length?(alert("请选择图片！"),!1):void checknow.check(function(){$("form.upprod").ajaxSubmit({type:"post",url:baseurl+"php/form.php",success:function(data){console.log(data);var dd=JSON.parse(data);dd.status&&$.post(baseurl+"php/updata.php",{money:$("[name=money]").eq(0).val(),title:$("[name=title]").eq(0).val(),src:"img/"+dd.fileName},function(repson){var repp=eval("("+repson+")");alert(repp.message),$http.get(baseurl+"php/prod.php").success(function(e){$scope.data=e.data})})},error:function(e,o,t){console.log(e),console.log(o),console.log(t)}})})},$scope.changepage=function(){for(var e=0,o=0;o<$scope.data.length;o++)for(var t in $scope.dictionary)$scope.dictionary[t][$scope.language]==$scope.searchrange&&$scope.data[o][t].toString().indexOf($scope.search)>-1&&e++;$scope.pagecount=Math.ceil(e/$scope.pagerows);for(var s=[],a=1;a<=$scope.pagecount;a++)s.push(a);$scope.arr=s,$scope.pageindex=1,console.log(e)}}]);