$(".buyproduct").hide(),$(function(){function cal(){$.each($(".item-all"),function(e,t){var a=0,s=0;$.each($(t).closest(".buyproduct").find("ul"),function(e,t){a+=parseInt($(t).find(".amount").text()),s+=parseInt($(t).find(".money").text())*parseInt($(t).find(".amount").text())}),$(t).find("span").eq(0).text(a),$(t).find("span").eq(1).text("￥ "+s)})}$("header").load("header1.html",function(e,t,a){"success"==t&&($(".header1").find("div").text("确认下单"),setTimeout(function(){$("header").show()},50))}),$("footer").load("footer1.html",function(responseTxt,statusTxt,xhr){"success"==statusTxt&&($(".footer a").eq(0).html("共 <span>0</span> 件").end().eq(1).html("总金额  ￥ <span>0</span>").end().eq(2).text("提交订单"),setTimeout(function(){$("footer").show()},50),$.post(baseurl+"php/address.php",{style:"slect"},function(rep){var result=eval("("+rep+")");if(result.state){if(0==result.message.length)$(".buyaddress>ul").html("还没有添加地址，请添加地址");else{var defaultadr={state:!1};$.each(result.message,function(e,t){"true"==t.able&&(defaultadr=t,defaultadr.state=!0)}),defaultadr.state||(defaultadr=result.message[0]),$("div.buyaddress").find(".toname").text(defaultadr.name).end().find(".tophone").text(defaultadr.phone).end().find(".toaddress").text(defaultadr.address)}$(".buyaddress").show()}}),$.get(baseurl+"php/showbuylist.php",function(e){var t=JSON.parse(e);if(t.state){for(var a=[],s=0;s<t.data.length;s++)a.push({data:JSON.parse(t.data[s].product),listnum:t.data[s].listnum,payway:t.data[s].payway});({data:{payment:t.data[0]}});if(a.length<=0)$(".buyproduct").remove();else{var n={baseDom:".buyproduct",cloneSize:3,data:{data:a},toscroll:!0,scrolldom:".tobuy",appenfcount:4,returnfun:cal,readydom:".ready"};new clonedom(n);$(".buyproduct").show()}}else location.assign("login.html")}))});var it=!0;$(document).on("touchstart",function(){it=!0}),$(document).on("touchmove",function(){it=!1}),$(document).on("touchend",function(evt){if(1==it)if($(evt.target).is(".buyaddress>ul *")||$(evt.target).is(".buyaddress>ul"))location.assign("address.html");else if($(evt.target).is("div.addnewad *")||$(evt.target).is("div.addnewad"))location.assign("newaddress.html");else if($(evt.target).is(":checkbox"))$(evt.target).is(":checked")?($("footer a span").eq(0).text(parseInt($("footer a span").eq(0).text())-parseInt($(evt.target).closest("div.item-all").find("span").eq(0).text().replace("￥ ",""))),$("footer a span").eq(1).text(parseInt($("footer a span").eq(1).text())-parseInt($(evt.target).closest("div.item-all").find("span").eq(1).text().replace("￥ ","")))):($("footer a span").eq(0).text(parseInt($(evt.target).closest("div.item-all").find("span").eq(0).text().replace("￥ ",""))+parseInt($("footer a span").eq(0).text())),$("footer a span").eq(1).text(parseInt($(evt.target).closest("div.item-all").find("span").eq(1).text().replace("￥ ",""))+parseInt($("footer a span").eq(1).text())));else if($(evt.target).is("footer div:nth-child(3) a"))if(0==$("footer a span").eq(0).text())alert("请选择商品");else{var arr=[];$.each($("input:checked"),function(e,t){arr.push($(t).closest("div.buyproduct").find("div.item div").eq(1).text())}),$.post(baseurl+"php/ordergoods.php",{list:JSON.stringify(arr),num:(new Date).getTime(),name:$(".toname").text(),phone:$(".tophone").text(),address:$(".toaddress").text(),creattime:(new Date).toDateString()},function(rep){"out"==eval("("+rep+")").state?location.assign("login.html"):(alert(eval("("+rep+")").message),eval("("+rep+")").state&&($.each($("input:checked"),function(e,t){$(t).closest("div.buyproduct").remove()}),location.assign("takegoods.html")))})}})});