<!DOCTYPE html>
<html ng-app="hrapp">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
		<title>QQ音乐</title>
		<style type="text/css">
			body #hr td {
				vertical-align: middle;
			}
			
			body #hr td img {
				width: 45px;
				height: 45px;
			}
		</style>
	</head>
	<link rel="stylesheet" href="../lib/bootstrap/css/bootstrap.css" />
	<link rel="stylesheet" href="../lib/font-awesome/css/font-awesome.css" />
	<link rel="stylesheet" type="text/css" href="../css/weui.css" />

	<body ng-controller="indexCtrl">
		<h3>热门榜单Top100</h3>
		<loading></loading>
		<table class="table table-striped">
			<thead>
				<tr>
					<th>序号</th>
					<th>封面</th>
					<th>标题</th>
					<th>歌手</th>
					<th>试听</th>
					<th>下载</th>
				</tr>
			</thead>

			<tbody id="hr">
				<div class="weui-loadmore" ng-show="isLoading">
					<i class="weui-loading"></i>
					<span class="weui-loadmore__tips">正在加载</span>
				</div>
				<tr ng-repeat="n in musiclist | limitTo: rows : (page - 1) * rows">
					<td ng-bind="$index + 1 + (page-1)*rows"></td>
					<td><img ng-src="{{n.albumpic_small}}" alt="" /></td>
					<td ng-bind="n.songname"></td>
					<td ng-bind="n.singername"></td>
					<td>
						<a ng-href="{{n.url}}" ng-bind="listen"></a>
					</td>
					<td>
						<a ng-href="{{n.downUrl}}" ng-bind="down"></a>
					</td>
				</tr>
			</tbody>
			<tfoot>
				<tr>
					<td colspan="10">
						<div>
							<ul class="pagination pagination-teal music" ng-click="pagination($event)">
								<li class="disabled">
									<a href="#"><i class="fa fa-chevron-left"></i></a>
								</li>
								<li class="{{n + 1 == page ? 'active' : ''}}" ng-repeat="n in [] | rang: pagecount">
									<a href="#" ng-bind="$index + 1"></a>
								</li>
								<li>
									<a href="#"><i class="fa fa-chevron-right"></i></a>
								</li>
							</ul>
						</div>
					</td>
				</tr>
			</tfoot>
		</table>
	</body>
	<script src="../js/angular.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		var app = angular.module('hrapp', []);
		app.controller('indexCtrl', function($scope, $http) {
			$scope.down = "下载地址";
			$scope.listen = "试听地址";
			$scope.topid = 5;
			$scope.rows = 10;
			$scope.page = 1;
			$scope.isLoading = true;
			$http.get('../data/qq_music.php', {
				params: {
					type: $scope.topid
				}
			}).then(function(data) {
				$scope.musiclist = data.data.showapi_res_body.pagebean.songlist;
				$scope.pagecount = $scope.musiclist.length / $scope.rows;
				$scope.isLoading = false;
			});
			//点击分页
			$scope.pagination = function(event) {
				$scope.page = event.target.innerHTML;
			}

		});
		app.filter('rang', function() {
			return function(array, rang) {
				if(!(array instanceof Array)) {
					array = [];
				}
				if(typeof rang != 'number' || parseInt(rang) < 1) {
					rang = 1;
				}
				for(var i = 0; i < rang; i++) {
					array.push(i);
				}
				return array;
			}
		});
		app.directive('loading', function() {
			return {
				restrict: 'AE',
				templateUrl: '../directives/loading.html',
				controller: 'indexCtrl'
			}
		})
	</script>

</html>